parameters:
  - name: osmodifierBuildType
    displayName: OSModifier build type
    type: string
    values:
      - main
      - preview

  - name: osModifierVersion
    displayName: OSModifier version
    type: string
    default: ""

steps:
  - ${{ if and(eq(parameters.osmodifierBuildType, 'main'), eq(parameters.osModifierVersion, '')) }}:
    - task: DownloadPipelineArtifact@2
      displayName: "Download OSModifier artifact (main - latest)"
      inputs:
        buildType: 'specific'
        project: 'polar'
        definition: '5139'
        buildVersionToDownload: 'latestFromBranch'
        branchName: 'refs/heads/main'
        artifactName: 'osmodifier'
        targetPath: "$(Build.SourcesDirectory)/artifacts"

  - ${{ if and(eq(parameters.osmodifierBuildType, 'preview'), eq(parameters.osModifierVersion, '')) }}:
    - task: DownloadPipelineArtifact@2
      displayName: "Download OSModifier artifact (preview - latest)"
      inputs:
        buildType: 'specific'
        project: 'polar'
        definition: '5142'
        buildVersionToDownload: 'latestFromBranch'
        branchName: 'refs/heads/main'
        artifactName: 'osmodifier_preview'
        targetPath: "$(Build.SourcesDirectory)/artifacts"

  - ${{ if and(eq(parameters.osmodifierBuildType, 'main'), ne(parameters.osModifierVersion, '')) }}:
    - task: UniversalPackages@0
      displayName: "Download OSModifier (main - pinned version)"
      inputs:
        command: download
        vstsFeed: polar/PolarCoreArtifacts
        vstsFeedPackage: osmodifier
        vstsPackageVersion: ${{ parameters.osModifierVersion }}
        downloadDirectory: "$(Build.SourcesDirectory)/artifacts"

  - ${{ if and(eq(parameters.osmodifierBuildType, 'preview'), ne(parameters.osModifierVersion, '')) }}:
    - task: UniversalPackages@0
      displayName: "Download OSModifier (preview - pinned version)"
      inputs:
        command: download
        vstsFeed: polar/PolarCoreArtifacts
        vstsFeedPackage: osmodifier_preview
        vstsPackageVersion: ${{ parameters.osModifierVersion }}
        downloadDirectory: "$(Build.SourcesDirectory)/artifacts"
