parameters:
  - name: "registry"
    displayName: "Container registry to push to"
    type: string
    default: "maritimuspublic"

  - name: "config"
    displayName: "Trident configuration"
    type: string

steps:
  - bash: |
      set -eux

      if [ ${{ parameters.config }} != 'misc' ]; then
        echo "Skipping step. Configuration is '${{ parameters.config }}'."
        exit 0
      fi

      VERSION="1.2.2"
      curl -LO "https://github.com/oras-project/oras/releases/download/v${VERSION}/oras_${VERSION}_linux_amd64.tar.gz"
      mkdir -p oras-install/
      tar -zxf oras_${VERSION}_*.tar.gz -C oras-install/
      sudo mv oras-install/oras /usr/local/bin/
      rm -rf oras_${VERSION}_*.tar.gz oras-install/
    displayName: "Install ORAS"
    retryCountOnTaskFailure: 3

  # - task: AzureCLI@2
  #   inputs:
  #     azureSubscription: maritimus-staging-eastus-cr-service-connection
  #     scriptType: bash
  #     scriptLocation: inlineScript
  #     inlineScript: |
  #       set -eux

  #       if [ ${{ parameters.config }} != 'misc' ]; then
  #         echo "Skipping step. Configuration is '${{ parameters.config }}'."
  #         exit 0
  #       fi

  #       # Login to ACR
  #       az acr login -n ${{ parameters.registry }}
  #   displayName: "Az ACR login"
  #   retryCountOnTaskFailure: 3
