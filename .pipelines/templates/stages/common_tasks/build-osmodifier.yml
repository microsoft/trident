parameters:
  - name: osModifierBranch
    type: string
    default: "submodule"

steps:
  - bash: |
      set -ex

      if [[ "${{ parameters.osModifierBranch }}" != "submodule" ]]; then
        rm -rf azure-linux-image-tools
        git clone --branch ${{ parameters.osModifierBranch }} https://github.com/microsoft/azure-linux-image-tools azure-linux-image-tools
      else
        git submodule init
        git submodule update --remote
      fi

      mkdir -p artifacts
      make artifacts/osmodifier
    displayName: "Build OSModifier"
    workingDirectory: $(Build.SourcesDirectory)
    retryCountOnTaskFailure: 3
