parameters:
  - name: "imageName"
    type: string

  - name: "registry"
    displayName: "Container registry to push to"
    type: string
    default: "maritimuspublic"

stages:
  - stage: PushTridentTestImg_${{ replace(parameters.imageName, '-', '_') }}
    displayName: Push ${{ parameters.imageName }} to ACR
    dependsOn:
      - TridentTestImg_${{ replace(parameters.imageName, '-', '_') }}

    variables:
      ob_outputDirectory: $(Pipeline.Workspace)/s/output
      ob_artifactBaseName: ${{ parameters.imageName }}

    jobs:
      - job: LoginToAcr
        displayName: Login
        timeoutInMinutes: 20
        pool:
          type: linux

        steps:
          - task: AzureCLI@2
            inputs:
              azureSubscription: maritimus-staging-eastus-cr-umi
              scriptType: bash
              inlineScript: |
                az acr login --name ${{ parameters.registry }}
