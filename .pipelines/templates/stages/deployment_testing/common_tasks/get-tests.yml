parameters:
  - name: buildPurpose
    type: string
    default: "post_merge"
    values:
      - daily
      - pullrequest
      - post_merge
      - validation

  - name: deploymentEnvironment
    type: string
    default: virtualMachine
    values:
      - bareMetal
      - virtualMachine

jobs:
  - job: DefineTests
    displayName: Get List of tests to run
    timeoutInMinutes: 10
    pool:
      type: linux

    variables:
      ob_outputDirectory: $(Build.SourcesDirectory)/build

    steps:
      - bash: |
          set -eux
          matrix=$(
              python3 ./e2e_tests/helpers/read_target_configurations.py \
                --config ./e2e_tests/target-configurations.yaml \
                --env ${{ parameters.deploymentEnvironment }} \
                --purpose ${{ parameters.buildPurpose }} \
              )
          echo "##vso[task.setvariable variable=matrixConfigurations;isOutput=true]$matrix"
        name: setConfigurations
        displayName: Matrix of trident configurations for E2E Tests
