parameters:
  - name: screenshotName
    type: string

  - name: vmName
    type: string
    default: "virtdeploy-vm-0"

  - name: captureScreenshot
    type: boolean
    default: true

steps:
  - bash: |
      set -eux
      mkdir -p $(ob_outputDirectory)
      # Capture screenshot from the VM using virsh and convert it to PNG format
      sudo virsh screenshot ${{ parameters.vmName }} /tmp/screenshot.ppm
      convert /tmp/screenshot.ppm $(ob_outputDirectory)/${{ parameters.screenshotName }}.png
    condition: and(succeededOrFailed(), eq('${{ parameters.captureScreenshot }}', true))
    displayName: "ðŸ“· Capture screenshot: ${{ parameters.screenshotName }}"
