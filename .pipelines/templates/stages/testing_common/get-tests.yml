parameters:
  - name: buildPurpose
    type: string
    default: "post_merge"
    values:
      - daily
      - pullrequest
      - post_merge
      - validation
      - weekly

  - name: deploymentEnvironment
    type: string
    default: virtualMachine
    values:
      - bareMetal
      - virtualMachine

  - name: runtimeEnv
    displayName: "Runtime environment (host vs container)"
    type: string
    values:
      - host
      - container

  - name: tridentRepoName
    type: string
    default: self

jobs:
  - job: DefineTests
    displayName: Get List of tests to run
    timeoutInMinutes: 10
    pool:
      type: linux

    variables:
      ob_outputDirectory: $(Build.SourcesDirectory)/build
      ob_artifactBaseName: select_tests_${{ parameters.deploymentEnvironment }}_${{ parameters.runtimeEnv }}_$(System.JobAttempt)

    steps:
      - checkout: ${{ parameters.tridentRepoName }}
        fetchDepth: 1
        path: s/trident
      - template: ../common_tasks/avoid-pypi-usage.yml
      - bash: |
          python3 ./tests/e2e_tests/helpers/read_target_configurations.py \
              --configurations ./tests/e2e_tests/target-configurations.yaml \
              --env ${{ parameters.deploymentEnvironment }} \
              --runtimeEnv ${{ parameters.runtimeEnv }} \
              --purpose ${{ parameters.buildPurpose }} \
              --matrix-name matrixConfigurations
        name: setConfigurations
        displayName: Matrix of Trident configurations for E2E Tests
        workingDirectory: $(Pipeline.Workspace)/s/trident
