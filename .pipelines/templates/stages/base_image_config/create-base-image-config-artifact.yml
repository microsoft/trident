parameters:
  - name: baseimgBuildType
    type: string
    values:
      - dev
      - preview
      - release
    default: "release"

  - name: baseImagePipelineBuildId
    type: string
    default: "latestFromBranch"

  - name: baseImageArm64PipelineBuildId
    type: string
    default: "latestFromBranch"

  - name: previousStage
    type: string
    default: ''
    
stages:
  - stage: CreateBaseImageConfig
    displayName: "Create BaseImage config artifact"
    ${{ if ne(parameters.previousStage, '') }}:
      dependsOn: ${{ parameters.previousStage }}
    jobs:
      - job: CreateBaseImageConfigJob
        displayName: "Create BaseImage config artifact"
        pool:
          type: linux
        variables:
          - name: ob_outputDirectory
            value: "$(Build.SourcesDirectory)/base-image-config"
          - name: ob_artifactBaseName
            value: "base-image-config"
        steps:
          - bash: |
              mkdir -p $(ob_outputDirectory)
              cat << EOF > $(ob_outputDirectory)/baseimage.json
              {
                "baseimgBuildType": "${{ parameters.baseimgBuildType }}",
                "baseImagePipelineBuildId": "${{ parameters.baseImagePipelineBuildId }}",
                "baseImageArm64PipelineBuildId": "${{ parameters.baseImageArm64PipelineBuildId }}"
              }
              EOF
            displayName: "Create Base Image Config artifact"
