parameters:
- name: argusDirectory
  type: string
  default: self

- name: isogenArtifactSource
  type: string
  default: current # If specific, job won't run and instead the artifact will be downloaded in other stage.

stages:
- stage: BuildingTools
  displayName: Building Tools

  jobs:
  - job: BuildIsogen
    displayName: Build Isogen
    condition: eq('${{ parameters.isogenArtifactSource }}', 'current')
    timeoutInMinutes: 60
    pool:
      type: linux
      name: CAPKV_Pool
      hostArchitecture: amd64

    variables:
      argusToolkitSourceDirectory: $(Build.SourcesDirectory)/argus-toolkit

      ob_outputDirectory: $(argusToolkitSourceDirectory)/build
      ob_artifactBaseName: isogen

    steps:
    - checkout: ${{ parameters.argusDirectory }}

    - bash: |
        set -eux
        make build/isogen
      workingDirectory: $(argusToolkitSourceDirectory)
      displayName: "Building Isogen tool"
