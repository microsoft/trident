FROM mcr.microsoft.com/cbl-mariner/base/core:2.0

RUN \
    tdnf -y install \
    netplan mdadm tpm2-tools veritysetup cryptsetup && \
    tdnf clean all

COPY artifacts/systemd /systemd
COPY bin/RPMS/x86_64 /trident

RUN \
    tdnf install -y /systemd/*.rpm /trident/trident-0*.rpm && \
    tdnf clean all

ENV DOCKER_ENVIRONMENT=true

ENTRYPOINT ["/usr/bin/trident"]
