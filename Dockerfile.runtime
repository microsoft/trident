FROM mcr.microsoft.com/cbl-mariner/base/core:2.0

RUN \
    tdnf -y install \
    netplan mdadm tpm2-tools veritysetup cryptsetup && \
    tdnf clean all

RUN \
    --mount=type=bind,source=./,target=/trident \
    tdnf install -y \
    /trident/artifacts/systemd/*.rpm \
    /trident/bin/RPMS/x86_64/trident-0*.rpm && \
    tdnf clean all

ENV DOCKER_ENVIRONMENT=true

ENTRYPOINT ["/usr/bin/trident"]
