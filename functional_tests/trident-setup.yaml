hostConfiguration:
  trident:
    selfUpgrade: true
  os:
    network:
      ethernets:
        vmeths:
          match:
            name: enp*
          dhcp4: true
      version: 2
    users:
      - name: testuser
        secondaryGroups:
          - wheel
        sshPublicKeys: []
        sshMode: key-only
  scripts:
    postConfigure:
      - content: 'echo "%wheel ALL=(ALL:ALL) NOPASSWD: ALL" > /etc/sudoers.d/wheel'
        name: wheel
        servicingType:
          - clean-install
      - content: |
          mkdir -p /data
          cd /data
          curl -O http://NETLAUNCH_HOST_ADDRESS/files/esp.rawzst
          curl -O http://NETLAUNCH_HOST_ADDRESS/files/root.rawzst
          curl -O http://NETLAUNCH_HOST_ADDRESS/files/verity_boot.rawzst
          curl -O http://NETLAUNCH_HOST_ADDRESS/files/verity_root.rawzst
          curl -O http://NETLAUNCH_HOST_ADDRESS/files/verity_roothash.rawzst
        name: download-images
        servicingType:
          - clean-install
  storage:
    abUpdate:
      volumePairs:
        - id: root
          volumeAId: root-a
          volumeBId: root-b
    images:
      - format: raw-zst
        sha256: ignored
        targetId: esp
        url: http://NETLAUNCH_HOST_ADDRESS/files/esp.rawzst
      - format: raw-zst
        sha256: ignored
        targetId: root
        url: http://NETLAUNCH_HOST_ADDRESS/files/root.rawzst
    disks:
      - device: /dev/disk/by-path/pci-0000:00:1f.2-ata-2
        id: os
        partitionTableType: gpt
        partitions:
          - id: esp
            size: 50M
            type: esp
          - id: root-a
            size: 5G
            type: root
          - id: root-b
            size: 2G
            type: root
          - id: swap
            size: 2G
            type: swap
          - id: trident
            size: 100M
            type: linux-generic
    mountPoints:
      - filesystem: vfat
        options:
          - umask=0077
        path: /boot/efi
        targetId: esp
      - filesystem: ext4
        options:
          - defaults
        path: /
        targetId: root
      - filesystem: ext4
        options:
          - defaults
        path: /var/lib/trident
        targetId: trident
      - filesystem: swap
        options:
          - sw
        path: none
        targetId: swap
