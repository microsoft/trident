image:
  url: file://{{ .ImagePath }}
  sha384: ignored
storage:
  disks:
    - device: "{{ .DiskPath }}"
      id: os
      partitionTableType: gpt
      partitions:
        - id: esp
          size: 64M
          type: esp
        - id: root
          size: 4G
          type: root
        - id: system
          size: 4G
          type: linux-generic
  encryption:
    recoveryKeyUrl: file://{{ .RecoveryKeyPath }}
    volumes:
      - id: encrypted-system
        deviceName: encrypted-system
        deviceId: system
  filesystems:
    - deviceId: encrypted-system
      source: new
      mountPoint: /encrypted-system
    - deviceId: root
      mountPoint: /
    - deviceId: esp
      mountPoint:
        options: umask=0077
        path: /boot/efi
os:
  selinux:
    mode: disabled
  users:
    - name: {{ .Username }}
      secondaryGroups:
        - wheel
  additionalFiles:
    - source: {{ .RecoveryKeyPath }}
      destination: /recovery/recovery.key
      permissions: 0400
scripts:
  postConfigure:
    - name: user-password
      runOn:
        - clean-install
      path: {{ .PasswordScript }}
    - name: hostname
      runOn:
        - clean-install
      content: |
        echo "{{ .Hostname }}" > /etc/hostname
        hostname "{{ .Hostname }}"
    - name: setup-recovery-directory
      runOn:
        - clean-install
      content: |
        mkdir -p /recovery
        chmod 700 /recovery
