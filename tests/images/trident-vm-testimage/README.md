# Trident VM Test Image

This image is used for testing Trident adopting an already produced image (e.g.
generated by MIC). It is based on the baremetal
image and adds Trident as well as its dependencies. It also adds openssh-server
to allow for remote access. Finally, it contains duplicate set of partitions to
setup the disk layout for A/B update.

Two sets of images are available:

- regular
- with verity

For both, a set of corresponding update images is available.

## Additional Prerequisites

- Artifacts
  - **Trident RPMs**: expected in `base/trident/*.rpm`. Can be downloaded with
    `make download-trident-rpms`

## Building

To build the base image, run:

| Image type                   | Make command                                        | Output path                                    |
| ---------------------------- | --------------------------------------------------- | ---------------------------------------------- |
| Regular                      | `make build/trident-vm-grub-testimage.qcow2`        | `build/trident-vm-grub-testimage.qcow2`        |
| With verity `qcow2`          | `make build/trident-vm-grub-verity-testimage.qcow2` | `build/trident-vm-grub-verity-testimage.qcow2` |
| With verity fixed size `vhd` | `make build/trident-vm-grub-verity-testimage.vhd`   | `build/trident-vm-grub-verity-testimage.vhd`   |

To build the update images, run:

| Image type  | Make command                            | Output path                         |
| ----------- | --------------------------------------- | ----------------------------------- |
| Regular     | `make trident-vm-grub-testimage`        | `build/trident-vm-grub-testimage/*` |
| With verity | `make trident-vm-grub-verity-testimage` | `build/trident-vm-grub-testimage/*` |