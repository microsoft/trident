# Trident VM Test Image

This image is used for testing Trident adopting an already produced image (e.g.
generated by MIC). It is based on the baremetal
image and adds Trident as well as its dependencies. It also adds openssh-server
to allow for remote access. Finally, it contains duplicate set of partitions to
setup the disk layout for A/B update.

Two sets of images are available:

- regular
- with verity

For both, a set of corresponding update images is available.

## Additional Prerequisites

- Artifacts
  - **Trident RPMs**: expected in `bin/RPMS/**/*.rpm`. Can be created with
    `make bin/trident-rpms.tar.gz`

## Building

To build the base image, run:

| Image type                   | Make command                                        | Output path                                    |
| ---------------------------- | --------------------------------------------------- | ---------------------------------------------- |
| Regular                      | `make artifacts/trident-vm-grub-testimage.qcow2`        | `artifacts/trident-vm-grub-testimage.qcow2`        |
| With verity `qcow2`          | `make artifacts/trident-vm-grub-verity-testimage.qcow2` | `artifacts/trident-vm-grub-verity-testimage.qcow2` |
| With verity fixed size `vhd` | `make artifacts/trident-vm-grub-verity-testimage.vhd`   | `artifacts/trident-vm-grub-verity-testimage.vhd`   |

To build the update images, run:

| Image type  | Make command                            | Output path                         |
| ----------- | --------------------------------------- | ----------------------------------- |
| Regular     | `make trident-vm-grub-testimage`        | `artifacts/trident-vm-grub-testimage/*` |
| With verity | `make trident-vm-grub-verity-testimage` | `artifacts/trident-vm-grub-testimage/*` |
