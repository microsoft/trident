storage:
  bootType: efi
  disks:
    - maxSize: 5G
      partitionTableType: gpt
      partitions:
        - id: esp
          size: 8M
          type: esp
        - id: root
          size: 4G

  filesystems:
    - deviceId: esp
      mountPoint:
        options: umask=0077
        path: /boot/efi
      type: fat32
    - deviceId: root
      mountPoint: /
      type: ext4

os:
  bootloader:
    resetType: hard-reset

  selinux:
    mode: disabled

  kernelCommandLine:
    # Replicates BM base image settings, that would otherwise be lost
    extraCommandLine:
      - console=tty0
      - console=tty1
      - console=ttyS0
      - rd.debug
      - loglevel=6
      - log_buf_len=1M
      - systemd.journald.forward_to_console=1

  hostname: trident-vm-testimg

  packages:
    remove:
      - grub2-efi-binary

    install:
      # replace grub2-efi-binary with grub2-efi-binary-noprefix
      - grub2-efi-binary-noprefix
      - curl
      - dnf
      - efibootmgr
      - iproute
      - iptables
      - lsof
      - mdadm
      - netplan
      - openssh-server
      - tpm2-tools
      - trident-service
      - vim
      - audit
      # Packages required for functional tests, which currently use this image:
      - device-mapper
      - dosfstools
      - lvm2
      - veritysetup
      # Optional dependencies for NTFS
      - ntfs-3g
      - ntfsprogs

  services:
    enable:
      - sshd
      - trident

  users:
    - name: testuser
      sshPublicKeyPaths:
        - files/id_rsa.pub
      secondaryGroups:
        - wheel
  additionalFiles:
    - source: files/sudoers-wheel
      destination: /etc/sudoers.d/wheel
    - source: files/99-dhcp-eth0.network
      destination: /etc/systemd/network/99-dhcp-eth0.network

scripts:
  postCustomization:
    - path: scripts/post-install.sh
    - path: scripts/ssh-move-host-keys.sh
    - path: scripts/duid-type-to-link-layer.sh
    - path: scripts/update-os-release.sh
