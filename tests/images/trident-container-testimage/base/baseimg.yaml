storage:
  bootType: efi

  disks:
  - partitionTableType: gpt
    maxSize: 4G
    partitions:
    - id: esp
      type: esp
      size: 8M

    - id: rootfs
      size: grow

  filesystems:
  - deviceId: esp
    type: fat32
    mountPoint:
      path: /boot/efi
      options: umask=0077

  - deviceId: rootfs
    type: ext4
    mountPoint:
      path: /

os:
  bootloader:
    resetType: hard-reset
  hostname: trident-container-testimg

  kernelCommandLine:
    # Replicates BM base image settings, that would otherwise be lost
    extraCommandLine:
    - console=tty0
    - console=ttyS0
    - rd.info
    - log_buf_len=1M

  packages:
    remove:
      - grub2-efi-binary

    install:
      # replace grub2-efi-binary with grub2-efi-binary-noprefix
      - grub2-efi-binary-noprefix
      - curl
      - dnf
      - efibootmgr
      - iproute
      - iptables
      - lsof
      - mdadm
      - netplan
      - openssh-server
      - tpm2-tools
      - vim
      # Packages required for functional tests, which currently use this image:
      - device-mapper
      - dosfstools
      - lvm2
      - veritysetup
      # Optional dependencies for NTFS
      - ntfs-3g
      - ntfsprogs

      - docker-cli
      - moby-engine
      - squashfs-tools
      - tar

  additionalFiles:
  - source: files/trident-container.service
    destination: /usr/lib/systemd/system/trident-container.service

  services:
    enable:
      - trident-container
      - sshd

scripts:
  postCustomization:
  - path: scripts/post-install.sh
