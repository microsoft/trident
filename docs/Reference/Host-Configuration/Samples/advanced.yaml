# THIS FILE IS AUTOMATICALLY GENERATED BY `docbuilder/src/host_config/samples.rs::print_sample("advanced")`.
# DO NOT EDIT MANUALLY!
# 
# Advanced sample showcasing combination of RAID, encryption, dm-verity and A/B update.

storage:
  disks:
  - id: disk1
    device: /dev/disk/by-path/pci-0000:00:1f.2-ata-2
    partitionTableType: gpt
    partitions:
    - id: esp1
      type: esp
      size: 64M
    - id: boot-a1
      type: xbootldr
      size: 512M
    - id: boot-b1
      type: xbootldr
      size: 512M
    - id: root-data-a1
      type: root
      size: 4G
    - id: root-data-b1
      type: root
      size: 4G
    - id: root-hash-a1
      type: root-verity
      size: 400M
    - id: root-hash-b1
      type: root-verity
      size: 400M
    - id: swap1
      type: swap
      size: 2G
    - id: trident1
      type: linux-generic
      size: 128M
    - id: trident-overlay-a1
      type: linux-generic
      size: 128M
    - id: trident-overlay-b1
      type: linux-generic
      size: 128M
    - id: var-a1
      type: linux-generic
      size: 1G
    - id: var-b1
      type: linux-generic
      size: 1G
    - id: enc-home1
      type: linux-generic
      size: 1G
  - id: disk2
    device: /dev/disk/by-path/pci-0000:00:1f.2-ata-3
    partitionTableType: gpt
    partitions:
    - id: esp2
      type: esp
      size: 64M
    - id: boot-a2
      type: xbootldr
      size: 512M
    - id: boot-b2
      type: xbootldr
      size: 512M
    - id: root-data-a2
      type: root
      size: 4G
    - id: root-data-b2
      type: root
      size: 4G
    - id: root-hash-a2
      type: root-verity
      size: 400M
    - id: root-hash-b2
      type: root-verity
      size: 400M
    - id: swap2
      type: swap
      size: 2G
    - id: trident2
      type: linux-generic
      size: 128M
    - id: trident-overlay-a2
      type: linux-generic
      size: 128M
    - id: trident-overlay-b2
      type: linux-generic
      size: 128M
    - id: var-a2
      type: linux-generic
      size: 1G
    - id: var-b2
      type: linux-generic
      size: 1G
    - id: enc-home2
      type: linux-generic
      size: 1G
  encryption:
    recoveryKeyUrl: file:///recovery.key
    volumes:
    - id: home
      deviceName: home
      deviceId: enc-home
  raid:
    software:
    - id: boot-a
      name: boot-a
      level: raid1
      devices:
      - boot-a1
      - boot-a2
    - id: boot-b
      name: boot-b
      level: raid1
      devices:
      - boot-b1
      - boot-b2
    - id: root-data-a
      name: root-data-a
      level: raid1
      devices:
      - root-data-a1
      - root-data-a2
    - id: root-data-b
      name: root-data-b
      level: raid1
      devices:
      - root-data-b1
      - root-data-b2
    - id: root-hash-a
      name: root-hash-a
      level: raid1
      devices:
      - root-hash-a1
      - root-hash-a2
    - id: root-hash-b
      name: root-hash-b
      level: raid1
      devices:
      - root-hash-b1
      - root-hash-b2
    - id: trident
      name: trident
      level: raid1
      devices:
      - trident1
      - trident2
    - id: trident-overlay-a
      name: trident-overlay-a
      level: raid1
      devices:
      - trident-overlay-a1
      - trident-overlay-a2
    - id: trident-overlay-b
      name: trident-overlay-b
      level: raid1
      devices:
      - trident-overlay-b1
      - trident-overlay-b2
    - id: var-a
      name: var-a
      level: raid1
      devices:
      - var-a1
      - var-a2
    - id: var-b
      name: var-b
      level: raid1
      devices:
      - var-b1
      - var-b2
    - id: enc-home
      name: home
      level: raid1
      devices:
      - enc-home1
      - enc-home2
    syncTimeout: 180
  abUpdate:
    volumePairs:
    - id: boot
      volumeAId: boot-a
      volumeBId: boot-b
    - id: root-data
      volumeAId: root-data-a
      volumeBId: root-data-b
    - id: root-hash
      volumeAId: root-hash-a
      volumeBId: root-hash-b
    - id: trident-overlay
      volumeAId: trident-overlay-a
      volumeBId: trident-overlay-b
    - id: var
      volumeAId: var-a
      volumeBId: var-b
  filesystems:
  - deviceId: esp1
    type: vfat
    source:
      type: esp-image
      url: file:///trident_cdrom/data/verity_esp.rawzst
      sha256: e15853875ce26f8fb8090177821240a889e21ac0c5acee75c5a060401bbdf0ae
      format: raw-zst
    mountPoint:
      path: /boot/efi
      options: umask=0077
  - deviceId: esp2
    type: vfat
    source:
      type: esp-image
      url: file:///trident_cdrom/data/verity_esp.rawzst
      sha256: e15853875ce26f8fb8090177821240a889e21ac0c5acee75c5a060401bbdf0ae
      format: raw-zst
  - deviceId: boot
    type: ext4
    source:
      type: image
      url: file:///trident_cdrom/data/verity_boot.rawzst
      sha256: b8170f4c46eab33f641e7e102a573d7ef6d8b27dc912b5ecfb033e82f1fff52a
      format: raw-zst
    mountPoint:
      path: /boot
      options: defaults
  - deviceId: trident
    type: ext4
    source:
      type: new
    mountPoint:
      path: /var/lib/trident
      options: defaults
  - deviceId: trident-overlay
    type: ext4
    source:
      type: new
    mountPoint:
      path: /var/lib/trident-overlay
      options: defaults
  - deviceId: swap1
    type: swap
    source:
      type: new
  - deviceId: swap2
    type: swap
    source:
      type: new
  - deviceId: var
    type: ext4
    source:
      type: image
      url: file:///trident_cdrom/data/verity_var.rawzst
      sha256: 1876c8c3921570a22d48f0c30e6509ed594cf7c22a2c26a718aadcc901194585
      format: raw-zst
    mountPoint:
      path: /var
      options: defaults
  - deviceId: home
    type: ext4
    source:
      type: new
    mountPoint:
      path: /home
      options: defaults
  - deviceId: root
    type: ext4
    mountPoint:
      path: /
      options: ro
  verity:
  - id: root
    name: root
    dataDeviceId: root-data
    hashDeviceId: root-hash
    corruptionOption: io-error
scripts:
  postConfigure:
  - name: rw-overlay
    runOn:
    - all
    content: mkdir -p /var/lib/trident-overlay/etc-rw/upper && mkdir -p /var/lib/trident-overlay/etc-rw/work
os:
  network:
    version: 2
    ethernets:
      eths:
        match:
          name: enp*
        dhcp4: true
  selinux:
    mode: null
  users:
  - name: my-custom-user
    sshPublicKeys:
    - <MY_PUBLIC_SSH_KEY>
    sshMode: key-only
  additionalFiles:
  - destination: /var/config-script.sh
    content: echo 'Hello, world!'
